<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Note Takers</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 860px;
      margin: auto;
      padding: 18px;
      font-size: 14px;
      background: #fff;
    }

    h2 {
      margin-bottom: 12px;
    }

    label.section {
      font-weight: bold;
      margin-top: 12px;
      display: block;
    }

    input, select, textarea {
      padding: 6px;
      margin-top: 4px;
      font-size: 13px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    input, textarea {
      width: 100%;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    select {
      max-width: 260px;
    }

    /* Radios with icons */
    .radio-group {
      display: flex;
      gap: 16px;
      margin-top: 6px;
    }

    .radio-group label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .yes { color: green; font-weight: bold; }
    .no { color: red; font-weight: bold; }

    /* Config rows */
    .config-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 8px;
    }

    .config-row input {
      flex: 1;
    }

    .config-row select {
      width: 110px;
    }

    .remove-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid #ccc;
      background: #f5f5f5;
      cursor: pointer;
      font-size: 14px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .remove-btn:hover {
      background: #e0e0e0;
    }

    button {
      margin-top: 12px;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #f7f7f7;
    }

    button:hover {
      background: #ededed;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }
  </style>
</head>
<body>

<h2>Note Takers</h2>

<label class="section">Integration Type</label>
<select id="integrationType">
  <option>OCS Integration</option>
  <option>OpenDental API Integration</option>
  <option>Denticon Integration</option>
  <option>NexHealth Integration</option>
  <option>Sikka Integration</option>
</select>

<label class="section">Contact Name</label>
<input id="contactName">

<label class="section">Phone Number</label>
<input id="phoneNumber">

<label class="section">Integration Status</label>
<select id="integrationStatus">
  <option value="" selected disabled>Select status</option>
  <option>Pending</option>
  <option>Active</option>
  <option>Stalled</option>
</select>

<label class="section">Server Access</label>
<div class="radio-group">
  <label><input type="radio" name="serverAccess" value="Yes"><span class="yes">✔</span>Yes</label>
  <label><input type="radio" name="serverAccess" value="No"><span class="no">✖</span>No</label>
</div>

<label class="section">Calendar Sync Configured</label>
<div class="radio-group">
  <label><input type="radio" name="calendarSync" value="Yes"><span class="yes">✔</span>Yes</label>
  <label><input type="radio" name="calendarSync" value="No"><span class="no">✖</span>No</label>
</div>

<label class="section">Configs / Operatory Setup</label>
<div id="configsContainer"></div>
<button onclick="addConfig()">+ Add Operatory</button>

<label class="section">Blocker</label>
<textarea id="blocker"></textarea>

<label class="section">Setup Summary</label>
<textarea id="setupSummary" placeholder="- Calendar sync completed"></textarea>

<div class="actions">
  <button id="gptFixBtn">Fix Grammar</button>
  <button id="copyBtn">Copy to Clipboard</button>
</div>

<script>
const BACKEND_URL = "https://notes-backend-yheh.onrender.com";

/* Duration dropdown */
function createDurationDropdown() {
  let options = `<option value="">Duration</option>`;
  for (let i = 5; i <= 120; i += 5) {
    options += `<option>${i} mins</option>`;
  }
  return `<select>${options}</select>`;
}

/* Add operatory */
function addConfig() {
  const row = document.createElement("div");
  row.className = "config-row";
  row.innerHTML = `
    <input placeholder="Column / Operatory">
    ${createDurationDropdown()}
    <button class="remove-btn" title="Remove">✕</button>
  `;
  row.querySelector(".remove-btn").onclick = () => row.remove();
  configsContainer.appendChild(row);
}
addConfig();

/* Auto bullets */
setupSummary.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    setupSummary.value += "\n- ";
  }
});

setupSummary.addEventListener("blur", () => {
  setupSummary.value = setupSummary.value
    .split("\n")
    .map(l => l.trim())
    .filter(Boolean)
    .map(l => l.startsWith("-") ? l : `- ${l}`)
    .join("\n");
});

/* GPT Fix */
gptFixBtn.onclick = async () => {
  if (!setupSummary.value) return;
  const res = await fetch(`${BACKEND_URL}/summary`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text: setupSummary.value })
  });
  const data = await res.json();
  setupSummary.value = data.cleaned;
};

/* Copy */
copyBtn.onclick = async () => {
  const serverAccess = document.querySelector('input[name="serverAccess"]:checked')?.value || "Not set";
  const calendarSync = document.querySelector('input[name="calendarSync"]:checked')?.value || "Not set";

  const configs = [...document.querySelectorAll(".config-row")]
    .map(r => {
      const [op, dur] = r.querySelectorAll("input, select");
      return `- ${op.value} | ${dur.value}`;
    }).join("\n");

  const note = `
${integrationType.value}

Contact Name: ${contactName.value}
Phone Number: ${phoneNumber.value}
Integration Status: ${integrationStatus.value || "Not set"}

Server Access: ${serverAccess}
Calendar Sync Configured: ${calendarSync}

Configs / Operatory Setup:
${configs}

Blocker:
${blocker.value}

Setup Summary:
${setupSummary.value}
`.trim();

  await navigator.clipboard.writeText(note);
  alert("Copied to clipboard");
};
</script>

</body>
</html>
