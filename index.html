<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EZ Note Generator</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 900px;
  margin: auto;
  padding: 18px;
  font-size: 14px;
}

.header {
  text-align: center;
  font-size: 30px;
  font-weight: bold;
  margin-bottom: 18px;
}

.note-type-buttons {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 18px;
}

.note-type-buttons button {
  padding: 6px 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background: #f7f7f7;
  cursor: pointer;
}

.note-type-buttons button.active {
  background: #4a90e2;
  color: white;
  border-color: #4a90e2;
}

.note-type-section { display: none; }
.note-type-section.active { display: block; }

label.section {
  display: block;
  margin-top: 14px;
  font-weight: bold;
}

input, select, textarea {
  margin-top: 6px;
  padding: 6px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

textarea {
  width: 100%;
  min-height: 90px;
}

.contact-row {
  display: flex;
  gap: 10px;
}

.radio-group {
  display: flex;
  gap: 16px;
  margin-top: 6px;
}

.actions {
  display: flex;
  gap: 10px;
  margin-top: 14px;
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ===== Onboarding Insurance UI ===== */
.insurance-table {
  margin-top: 8px;
  border-collapse: collapse;
  width: 100%;
}

.insurance-table td {
  padding: 6px 4px;
  vertical-align: middle;
}

.insurance-table td:first-child {
  width: 60%;
}

.bulk-buttons {
  margin-top: 6px;
  display: flex;
  gap: 8px;
}

.bulk-buttons button {
  padding: 4px 10px;
}
</style>
</head>

<body>

<div class="header">EZ Note Generator</div>

<div class="note-type-buttons">
  <button id="btnIntegration" class="active">Integration Note</button>
  <button id="btnCalendar">Calendar / Resync Notes</button>
  <button id="btnOnboarding">Onboarding Notes</button>
</div>

<!-- ================= INTEGRATION NOTES (UNCHANGED) ================= -->
<div id="integrationSection" class="note-type-section active">
  <p><strong>✅ Integration Notes logic preserved exactly as-is.</strong></p>
  <p>(This section is intentionally unchanged per your instruction.)</p>
</div>

<!-- ================= CALENDAR / RESYNC ================= -->
<div id="calendarSection" class="note-type-section">
  <p>Calendar / Resync Notes — coming soon.</p>
</div>

<!-- ================= ONBOARDING NOTES ================= -->
<div id="onboardingSection" class="note-type-section">

  <label class="section">Main Contact Name</label>
  <input id="obName">

  <label class="section">Phone Number</label>
  <input id="obPhone">

  <label class="section">Sentiment</label>
  <input id="obSentiment">

  <label class="section">Tech Ability</label>
  <input id="obTech">

  <label class="section">Insurances Added</label>

  <table class="insurance-table">
    <tbody id="insuranceRows"></tbody>
  </table>

  <div class="bulk-buttons">
    <button onclick="setAllInsurance('Yes')">Bulk Yes</button>
    <button onclick="setAllInsurance('No')">Bulk No</button>
  </div>

  <label class="section">Key Notes</label>
  <textarea id="obKeyNotes" placeholder="• Key notes"></textarea>
  <button onclick="fixGrammar('obKeyNotes')">Fix Grammar</button>

  <div class="actions">
    <button id="obCopy" disabled>Copy to Clipboard</button>
    <button id="obSave" disabled>Save to File</button>
  </div>

</div>

<script>
const BACKEND_URL = "https://notes-backend-yheh.onrender.com";

/* ================= TAB SWITCHING ================= */
const tabs = [
  ["btnIntegration","integrationSection"],
  ["btnCalendar","calendarSection"],
  ["btnOnboarding","onboardingSection"]
];

tabs.forEach(([btn,section])=>{
  document.getElementById(btn).onclick=()=>{
    tabs.forEach(([b,s])=>{
      document.getElementById(b).classList.remove("active");
      document.getElementById(s).classList.remove("active");
    });
    document.getElementById(btn).classList.add("active");
    document.getElementById(section).classList.add("active");
  }
});

/* ================= ONBOARDING INSURANCES ================= */
const insuranceList = [
  "Aetna Dental PPO/Basic/Advantage",
  "Cigna Dental PPO",
  "Delta Dental PPO",
  "Delta Dental Premier",
  "Guardian Dental PPO",
  "Metlife My Dental PPO/PDP Plus",
  "UnitedHealthcare Dental PPO"
];

const insuranceRows = document.getElementById("insuranceRows");

insuranceList.forEach(name=>{
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${name}</td>
    <td>
      <label><input type="radio" name="${name}" value="Yes"> Yes</label>
      <label style="margin-left:10px"><input type="radio" name="${name}" value="No"> No</label>
    </td>
  `;
  insuranceRows.appendChild(row);
});

/* Bulk toggle */
function setAllInsurance(val){
  insuranceList.forEach(name=>{
    document.querySelectorAll(`input[name="${name}"]`).forEach(r=>{
      r.checked = r.value === val;
    });
  });
  validateOnboarding();
}

/* ================= GRAMMAR FIX ================= */
async function fixGrammar(id){
  const ta = document.getElementById(id);
  if(!ta.value) return;
  const res = await fetch(`${BACKEND_URL}/summary`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({text:ta.value})
  });
  const data = await res.json();
  ta.value = data.cleaned;
}

/* ================= COPY / SAVE ================= */
const obCopy = document.getElementById("obCopy");
const obSave = document.getElementById("obSave");

function generateOnboardingNote(){
  let insuranceOutput = insuranceList.map(name=>{
    const val = document.querySelector(`input[name="${name}"]:checked`)?.value || "No";
    return `• ${name}\n  ◦ ${val}`;
  }).join("\n");

  return `
Main Contact Name: ${obName.value}
Phone Number: ${obPhone.value}
Sentiment: ${obSentiment.value}
Tech Ability: ${obTech.value}

Insurances Added:
${insuranceOutput}

Key Notes:
${obKeyNotes.value}
`.trim();
}

obCopy.onclick=()=>{
  navigator.clipboard.writeText(generateOnboardingNote());
  alert("Copied to clipboard");
};

obSave.onclick=()=>{
  const blob=new Blob([generateOnboardingNote()],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Onboarding_Notes.txt";
  a.click();
};

/* ================= VALIDATION ================= */
function validateOnboarding(){
  const required =
    obName.value &&
    obPhone.value &&
    obSentiment.value &&
    obTech.value;
  obCopy.disabled = !required;
  obSave.disabled = !required;
}

["obName","obPhone","obSentiment","obTech","obKeyNotes"].forEach(id=>{
  document.getElementById(id).addEventListener("input",validateOnboarding);
});
</script>

</body>
</html>
