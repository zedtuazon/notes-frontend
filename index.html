<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>EZ Note Generator</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 900px;
  margin: auto;
  padding: 18px;
  font-size: 14px;
  background: #fdfdfd;
}

.header {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  font-size: 28px;
  font-weight: bold;
  margin-bottom: 16px;
}

label.section {
  font-weight: bold;
  margin-top: 12px;
  display: block;
}

input, select, textarea {
  padding: 6px;
  margin-top: 4px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

textarea {
  width: 100%;
  min-height: 80px;
  resize: vertical;
}

.contact-row {
  display: flex;
  gap: 12px;
}

.radio-group {
  display: flex;
  gap: 16px;
  margin-top: 6px;
}

.yes { color: green; font-weight: bold; }
.no { color: red; font-weight: bold; }

.provider-group {
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 8px;
  margin-top: 10px;
  background: #fafafa;
}

.provider-header {
  display: flex;
  gap: 6px;
  align-items: center;
}

.provider-header input {
  flex: 1;
}

.config-group {
  margin-left: 16px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.config-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.config-row input {
  width: 40%;
}

.duration { width: 110px; }
.strategy { width: 140px; }

.arrow {
  font-weight: bold;
  margin: 0 6px;
}

.remove-btn {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 1px solid #ccc;
  background: #f5f5f5;
  cursor: pointer;
}

.remove-btn:hover {
  background: #e0e0e0;
}

.add-btn {
  margin-top: 6px;
  padding: 4px 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background: #f7f7f7;
  cursor: pointer;
}

.add-btn:hover {
  background: #eaeaea;
}

.actions {
  display: flex;
  gap: 10px;
  margin-top: 14px;
}

button {
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background: #f7f7f7;
  cursor: pointer;
}

button:disabled {
  background: #eee;
  cursor: not-allowed;
}

#configsSection {
  display: none;
}
</style>
</head>

<body>

<div class="header">üìù EZ Note Generator</div>

<label class="section">Practice Name</label>
<input id="practiceName">

<label class="section">Integration Type</label>
<select id="integrationType">
  <option value="" disabled selected>Select Integration</option>
  <option>Opencare Sync</option>
  <option>NexHealth API</option>
  <option>Sikka API</option>
  <option>Carestack API</option>
  <option>Denticon API</option>
  <option>Opendental API</option>
</select>

<label class="section">Contact Info</label>
<div class="contact-row">
  <input id="contactName" placeholder="Contact Name">
  <input id="phoneNumber" placeholder="Phone Number">
</div>

<label class="section">Integration Status</label>
<select id="integrationStatus">
  <option value="" disabled selected>Select status</option>
  <option>Pending</option>
  <option>Active</option>
  <option>Stalled</option>
</select>

<label class="section">Server Access</label>
<div class="radio-group">
  <label><input type="radio" name="serverAccess" value="Yes"> <span class="yes">‚úî</span> Yes</label>
  <label><input type="radio" name="serverAccess" value="No"> <span class="no">‚úñ</span> No</label>
</div>

<label class="section">Calendar Sync Configured</label>
<div class="radio-group">
  <label><input type="radio" name="calendarSync" value="Yes"> <span class="yes">‚úî</span> Yes</label>
  <label><input type="radio" name="calendarSync" value="No"> <span class="no">‚úñ</span> No</label>
</div>

<div id="configsSection">
  <button class="add-btn" onclick="addProvider()">‚ûï Add Provider</button>
  <div id="providersContainer"></div>
</div>

<label class="section">Blocker</label>
<textarea id="blocker"></textarea>

<label class="section">Setup Summary</label>
<textarea id="setupSummary"></textarea>

<div class="actions">
  <button id="copyBtn" disabled>üìã Copy to Clipboard</button>
  <button id="saveBtn" disabled>üíæ Save to File</button>
</div>

<script>
const providersContainer = document.getElementById("providersContainer");
const configsSection = document.getElementById("configsSection");
const copyBtn = document.getElementById("copyBtn");
const saveBtn = document.getElementById("saveBtn");

function durationDropdown() {
  let html = `<select class="duration"><option value="">Duration</option>`;
  for (let i = 5; i <= 120; i += 5) {
    html += `<option>${i} minutes</option>`;
  }
  return html + `</select>`;
}

function strategyDropdown() {
  return `<select class="strategy">
    <option value="Any Rooms">Any Rooms</option>
    <option value="All Rooms">All Rooms</option>
    <option value="Sequential">Sequential</option>
  </select>`;
}

function addOperatory(container) {
  const row = document.createElement("div");
  row.className = "config-row";
  row.innerHTML = `
    <input placeholder="Column / Operatory">
    ${durationDropdown()}
    ${strategyDropdown()}
    <span class="arrow" style="display:none">‚Üí</span>
    <button class="remove-btn">‚úï</button>
  `;

  const strategy = row.querySelector(".strategy");
  const arrow = row.querySelector(".arrow");

  strategy.onchange = () => {
    if (strategy.value === "Sequential") {
      arrow.style.display = "inline";
      addSequential(container);
    } else {
      arrow.style.display = "none";
    }
    validate();
  };

  row.querySelector(".remove-btn").onclick = () => {
    row.remove();
    validate();
  };

  row.querySelectorAll("input, select").forEach(el => el.oninput = validate);
  container.appendChild(row);
}

function addSequential(container) {
  const row = document.createElement("div");
  row.className = "config-row";
  row.innerHTML = `
    <input placeholder="Column / Operatory">
    ${durationDropdown()}
    <button class="remove-btn">‚úï</button>
  `;

  row.querySelector(".remove-btn").onclick = () => {
    row.remove();
    validate();
  };

  row.querySelectorAll("input, select").forEach(el => el.oninput = validate);
  container.appendChild(row);
}

function addProvider() {
  const group = document.createElement("div");
  group.className = "provider-group";
  group.innerHTML = `
    <div class="provider-header">
      <input class="provider-name" placeholder="Provider Name">
      <button class="remove-btn">‚úï</button>
    </div>
    <div class="config-group"></div>
    <button class="add-btn">‚ûï Add Operatory</button>
  `;

  const configGroup = group.querySelector(".config-group");
  group.querySelector(".add-btn").onclick = () => addOperatory(configGroup);
  group.querySelector(".remove-btn").onclick = () => {
    group.remove();
    validate();
  };
  group.querySelector(".provider-name").oninput = validate;

  providersContainer.appendChild(group);
  addOperatory(configGroup);
}

document.querySelectorAll('input[name="calendarSync"]').forEach(radio => {
  radio.onchange = () => {
    configsSection.style.display = radio.value === "Yes" ? "block" : "none";
    providersContainer.innerHTML = "";
    if (radio.value === "Yes") addProvider();
    validate();
  };
});

function validate() {
  const requiredFilled =
    integrationType.value &&
    integrationStatus.value &&
    document.querySelector('input[name="serverAccess"]:checked') &&
    document.querySelector('input[name="calendarSync"]:checked');

  let providersValid = true;
  if (document.querySelector('input[name="calendarSync"]:checked')?.value === "Yes") {
    const groups = [...document.querySelectorAll(".provider-group")];
    providersValid = groups.length > 0 && groups.every(g => {
      if (!g.querySelector(".provider-name").value) return false;
      return [...g.querySelectorAll(".config-row")].every(r =>
        [...r.querySelectorAll("input, select")].every(e => e.value)
      );
    });
  }

  copyBtn.disabled = !(requiredFilled && providersValid);
  saveBtn.disabled = !(requiredFilled && providersValid);
}

function generateNote() {
  const calendarSync = document.querySelector('input[name="calendarSync"]:checked').value;
  let text = "";

  text += `Integration Type: ${integrationType.value}\n\n`;
  text += `Contact Name: ${contactName.value}\n`;
  text += `Phone Number: ${phoneNumber.value}\n`;
  text += `Integration Status: ${integrationStatus.value}\n\n`;
  text += `Server Access: ${document.querySelector('input[name="serverAccess"]:checked').value}\n`;
  text += `Calendar Sync Configured: ${calendarSync}\n\n`;

  if (calendarSync === "Yes") {
    text += `Configs / Operatory Setup:\n`;
    document.querySelectorAll(".provider-group").forEach(group => {
      text += `${group.querySelector(".provider-name").value}:\n`;
      const rows = [...group.querySelectorAll(".config-row")];

      for (let i = 0; i < rows.length; i++) {
        const r = rows[i];
        const op = r.querySelector("input").value;
        const dur = r.querySelector(".duration").value;
        const strat = r.querySelector(".strategy")?.value;

        if (strat === "Sequential") {
          const r2 = rows[++i];
          text += `    ${op} ${dur} to ${r2.querySelector("input").value} ${r2.querySelector(".duration").value} | Sequential\n`;
        } else {
          text += `    ${op} ${dur} | ${strat}\n`;
        }
      }
    });
    text += "\n";
  }

  text += `Blocker:\n${blocker.value}\n\n`;
  text += `Setup Summary:\n${setupSummary.value}`;

  return text.trim();
}

copyBtn.onclick = async () => {
  await navigator.clipboard.writeText(generateNote());
  alert("Copied to clipboard");
};

saveBtn.onclick = () => {
  const blob = new Blob([generateNote()], { type: "text/plain" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = (practiceName.value || "EZ_Note") + ".txt";
  a.click();
};
</script>

</body>
</html>
